
load net;
load os;

class Server
{
	routine Start()
	{
#		io.writeln( net.host( '127.0.0.1' ) );
		io.writeln( net.host( 'localhost' ) );
		sock = net.listen( ':10000' );
		for (conn in sock){
			stream = conn.stream;
			message = stream.read();
			io.writeln( conn.addr );
			io.writeln( 'received', message );
			stream.serialize( [1,2,3,4,5] )
			stream.serialize( [1.5C,2,3,4,5] )
			stream.write( 'TEST' );
			stream.close();
			break;
		}
	}
}

class Client
{
	routine Start()
	{
		sockfd = net.connect( 'localhost:10000' );
		io.writeln( 'sending' );
		sockfd.write( 'TEST' );
		object1 = sockfd.deserialize()
		object2 = sockfd.deserialize()
		message = sockfd.read();
		io.writeln( 'received', object1, object2, message );
		sockfd.close();
	}
}

server = Server()
server.Start() !!
os.sleep(1);
client = Client()
client.Start() !!
