
project = DaoMake::Project( "DaoOS" )

daovm = DaoMake::FindPackage( "Dao", $REQUIRED )
daost = DaoMake::FindPackage( "DaoStream", $REQUIRED )

if( daovm == none or daost == none ) return

project.AddDirectory( "fs", "fs" )
project.AddDirectory( "process", "process" )

project.UseImportLibrary( daovm, "dao" )

dao_os_objs = project.AddObjects( { "dao_system.c" } )
dao_os_dll  = project.AddSharedLibrary( "dao_os", dao_os_objs )
dao_os_lib  = project.AddStaticLibrary( "dao_os", dao_os_objs )

project.AddIncludePath( "../stream" )
dao_os_dll.UseSharedLibrary( daost, "dao_stream" )

dest = DaoMake::MakePath( project.BinaryPath(), "../../lib/dao/modules/os/" );
src = DaoMake::MakePath( project.SourcePath(), "path/path.dao" );
cmd = project.AddCommand( "copypath:", "$(DAOMAKE) copy " + src + " " + dest );

project.SetTargetPath( "../../lib/dao/modules" )

project.Install( DaoMake::Variables[ "INSTALL_MOD" ], dao_os_dll );
project.Install( DaoMake::Variables[ "INSTALL_MOD" ], dao_os_lib );

findpkg = project.GenerateFinder( $TRUE );
project.Install( DaoMake::Variables[ "INSTALL_FINDER" ], findpkg );
